<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Backlog Manager</title>
    <style>

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1e1e1e;
            color: #f0f0f0;
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
        }

        h1 { text-align: center; color: #00ff99; margin-bottom: 30px; }


        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: 0.2s;
            margin: 5px;
        }
        .btn-primary { background-color: #007acc; color: white; }
        .btn-success { background-color: #00ff99; color: black; }
        .btn-danger { background-color: #ff4d4d; color: white; }
        .btn-secondary { background-color: #555; color: white; }
        .btn:hover { opacity: 0.8; }


        #menu-screen {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }
        .menu-btn {
            width: 100%;
            max-width: 300px;
            padding: 20px;
            font-size: 18px;
        }


        .game-card {
            background-color: #2d2d2d;
            border-left: 5px solid #00ff99;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .game-info h3 { margin: 0 0 5px 0; }
        .game-info p { margin: 2px 0; color: #aaa; font-size: 14px; }
        .status-badge {
            background-color: #444;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            color: #fff;
        }


        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            background-color: #333;
            border: 1px solid #555;
            color: white;
            border-radius: 4px;
            box-sizing: border-box; 
        }


        .screen { display: none; }
        .active { display: block; }

    </style>
</head>
<body>

    <div class="container">
        <h1>üéÆ Game Backlog</h1>

        <div id="menu-screen" class="screen active">
            <button class="btn btn-primary menu-btn" onclick="showLibrary()">üìö My Library</button>
            <button class="btn btn-success menu-btn" onclick="showAddForm()">‚ûï Add game</button>
        </div>

        <div id="library-screen" class="screen">
            <button class="btn btn-secondary" onclick="showMenu()">‚¨Ö Back to menu</button>
            <button class="btn btn-success" onclick="showAddForm()" style="float: right;">+ –î–æ–¥–∞—Ç–∏</button>
            <h2 style="border-bottom: 1px solid #444; padding-bottom: 10px;">Games list</h2>
            <div id="games-list">Loading...</div>
        </div>

        <div id="form-screen" class="screen">
            <h2 id="form-title">Add new game</h2>
            <input type="hidden" id="game-id"> <div class="form-group">
                <label>Game name:</label>
                <input type="text" id="title" placeholder="Witcher 3">
            </div>
            <div class="form-group">
                <label>Genre:</label>
                <input type="text" id="genre" placeholder="RPG">
            </div>
            <div class="form-group">
                <label>Status:</label>
                <select id="status">
                    <option value="Backlog">Backlog</option>
                    <option value="Playing">Playing</option>
                    <option value="Completed">Completed</option>
                    <option value="Dropped">Dropped</option>
                </select>
            </div>
            <div class="form-group">
                <label>Raiting (0-10):</label>
                <input type="number" id="rating" min="0" max="10" step="0.5">
            </div>
            <div class="form-group">
                <label>Comment:</label>
                <textarea id="comment" rows="3" placeholder="I think this game..."></textarea>
            </div>

            <button class="btn btn-success" onclick="saveGame()">üíæ Save</button>
            <button class="btn btn-secondary" onclick="showLibrary()">cancel</button>
        </div>
    </div>

<script>
        const API_URL = 'http://localhost:5187/api/Games'; 

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }
        function showMenu() { showScreen('menu-screen'); }
        
        async function showLibrary() {
            showScreen('library-screen');
            const listDiv = document.getElementById('games-list');
            listDiv.innerHTML = '<p>Loading...</p>';

            try {
                const response = await fetch(API_URL);
                const games = await response.json();

                listDiv.innerHTML = ''; 
                
                if (games.length === 0) {
                    listDiv.innerHTML = '<p>Library is empty.Add new game!</p>';
                    return;
                }

                games.forEach(game => {
                    const card = document.createElement('div');
                    card.className = 'game-card';
                    card.innerHTML = `
                        <div class="game-info">
                            <h3>${game.title} <span class="status-badge">${game.status}</span></h3>
                            <p>üé≠ –ñ–∞–Ω—Ä: ${game.genre} | ‚≠ê ${game.rating}/10</p>
                            <p>üí¨ ${game.comment || 'No Comments'}</p>
                        </div>
                        <div class="game-actions">
                            <button class="btn btn-primary" onclick='editGame(${JSON.stringify(game)})'>‚úèÔ∏è</button>
                            <button class="btn btn-danger" onclick="deleteGame(${game.id})">üóëÔ∏è</button>
                        </div>
                    `;
                    listDiv.appendChild(card);
                });
            } catch (error) {
                listDiv.innerHTML = '<p style="color:red">Error connecting with the server.Check port!</p>';
                console.error(error);
            }
        }

        function showAddForm() {
            document.getElementById('form-title').innerText = "Add new game";
            document.getElementById('game-id').value = ''; 
            document.getElementById('title').value = '';
            document.getElementById('genre').value = '';
            document.getElementById('status').value = 'Backlog';
            document.getElementById('rating').value = '';
            document.getElementById('comment').value = '';
            showScreen('form-screen');
        }

        function editGame(game) {
            document.getElementById('form-title').innerText = "Update game";
            document.getElementById('game-id').value = game.id;
            document.getElementById('title').value = game.title;
            document.getElementById('genre').value = game.genre;
            document.getElementById('status').value = game.status;
            document.getElementById('rating').value = game.rating;
            document.getElementById('comment').value = game.comment;
            showScreen('form-screen');
        }

        async function saveGame() {
            const id = document.getElementById('game-id').value;
            
            const gameData = {
                id: id ? parseInt(id) : 0,
                title: document.getElementById('title').value,
                genre: document.getElementById('genre').value,
                status: document.getElementById('status').value,
                rating: parseFloat(document.getElementById('rating').value) || 0,
                comment: document.getElementById('comment').value
            };

            const method = id ? 'PUT' : 'POST';
            
            const url = id ? `${API_URL}/${id}` : API_URL;

            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(gameData)
                });

                if (response.ok) {
                    showLibrary(); 
                } else {
                    alert('Error!');
                }
            } catch (error) {
                console.error(error);
                alert('Server not responding');
            }
        }

        async function deleteGame(id) {
            if (!confirm('U sure u want delete this game?')) return;

            try {
                await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                showLibrary(); 
            } catch (error) {
                console.error(error);
                alert('Error');
            }
        }
    </script>
</body>
</html>